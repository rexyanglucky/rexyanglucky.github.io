webpackJsonp([2],{"3cXf":function(e,n,t){e.exports={default:t("4rP4"),__esModule:!0}},"4rP4":function(e,n,t){var i=t("UusJ"),a=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},"6PfM":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("AA3o"),a=t.n(i),s=function e(){a()(this,e)};s.log=function(e){console.log(e)};var l=function e(){a()(this,e)};l.show=function(e){$.snackbar({content:e,timeout:3e3})};var r=function e(){a()(this,e)};r.getParameterByName=function(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null};var o=function e(){a()(this,e)},c={"&":"&amp;","<":"&lt;",">":"&gt;"};o._replaceTag=function(e){return c[e]||e},o.safe_tags_replace=function(e){return e.replace(/[&<>]/g,o._replaceTag)};var u=t("xSur"),d=t.n(u),h=function(){function e(n){a()(this,e),this.appid=n,this.rtc=AgoraRTC.createClient({mode:"interop"}),this.localStream=null,this.uid=null,this.remoteStreams=[],this.videoProfile="720p_6",this.dynamicKey=null,this.published=!1,this.muted=!1,this.subscribeStreamEvents()}return d()(e,[{key:"init",value:function(e,n){var t=this,i=$.Deferred(),a=this.appid,s=(this.uid,this.rtc);return this.getDynamicKey(e).then($.proxy(function(l){s.init(a,$.proxy(function(a){s.join(l,e,void 0,$.proxy(function(e){var a={streamID:e,audio:!0,video:!0,screen:!1};t.uid=e;var l=AgoraRTC.createStream(a);l.setVideoProfile(t.videoProfile),t.localStream=l,l.init($.proxy(function(e){t.rearrangeStreams(),n&&s.publish(l),i.resolve(l)},t))},t),function(e){i.reject(e)})},t))},this)),i.promise()}},{key:"end",value:function(){var e=$.Deferred(),n=this.rtc,t=this.localStream;return null===t?e.resolve().promise():(this.clearStreams(),this.published&&(n.unpublish(this.localStream),this.published=!1),t.close(),this.localStream=null,this.remoteStreams=[],n.leave(function(n){e.resolve()},function(n){e.reject()}),e)}},{key:"applyMute",value:function(){var e=this.localStream;null!==e&&(this.muted?e.disableAudio():e.enableAudio())}},{key:"toggleMute",value:function(){this.muted=!this.muted,this.applyMute()}},{key:"subscribeWindowResizeEvent",value:function(){var e=this,n=void 0;$(window).resize($.proxy(function(t){n=e.calculateStreamSize(),null!==e.localStream&&e.resizeStream(e.localStream,n)},this))}},{key:"subscribeStreamEvents",value:function(){var e=this,n=this.rtc;n.on("stream-added",function(e){var t=e.stream;s.log("New stream added: "+t.getId()),s.log("Timestamp: "+Date.now()),s.log("Subscribe ",t),n.subscribe(t,function(e){s.log("Subscribe stream failed",e)})}),n.on("peer-leave",$.proxy(function(n){s.log("Peer has left: "+n.uid),s.log("Timestamp: "+Date.now()),s.log(n),e.removeRemoteStream(n.uid),e.rearrangeStreams()},this)),n.on("stream-subscribed",$.proxy(function(n){var t=n.stream;s.log("Got stream-subscribed event"),s.log("Timestamp: "+Date.now()),s.log("Subscribe remote stream successfully: "+t.getId()),s.log(n),e.addRemoteStream(t),e.rearrangeStreams()},this)),n.on("stream-removed",function(n){var t=n.stream;s.log("Stream removed: "+n.stream.getId()),s.log("Timestamp: "+Date.now()),s.log(n),e.removeRemoteStream(t.getId()),e.rearrangeStreams()}),n.on("stream-published",$.proxy(function(n){e.published=!0},this))}},{key:"rearrangeStreams",value:function(){var e=this.remoteStreams,n=this.localStream;this.clearStreams(),null!==n&&(s.log("Rearranging streams, local:"+n.getId()+", remote: "+(0===e.length?"NONE":e[0].id)),0===e.length?this.displayStream($(".media_warp"),n,"fullscreen"):1===e.length&&(this.displayStream($(".media_warp"),e[0].stream,"fullscreen"),this.displayStream($(".media_warp"),n,"side")))}},{key:"clearStreams",value:function(){$("[role=stream]").remove()}},{key:"addRemoteStream",value:function(e){this.remoteStreams.push({stream:e,id:e.getId()})}},{key:"removeRemoteStream",value:function(e){this.remoteStreams=this.remoteStreams.filter(function(n){return n.id!==e})}},{key:"resizeStream",value:function(e,n){$("#"+e.getId()).css({width:n.width+"px",height:n.height+"px"})}},{key:"displayStream",value:function(e,n,t){if($("#"+n.getId()).remove(),e.append('<div id="'+n.getId()+'" class="'+(n===this.localStream?"agora-local":"agora_remote")+'" role="stream" data-stream-id="'+n.getId()+'"></div>'),"fullscreen"===t){this.calculateStreamSize();$("#"+n.getId()).css({width:"100%",height:"100%"})}else $("#"+n.getId()).removeClass("side_stream").addClass("side_stream"),$("#"+n.getId()).css({width:"160px",height:"120px",position:"absolute",top:0,right:0});n.play(n.getId())}},{key:"getDynamicKey",value:function(e){return(new $.Deferred).resolve(void 0).promise()}},{key:"getResolutionArray",value:function(e){switch(e){case"120p":return[160,120];case"240p":return[320,240];case"360p":return[640,360];case"480p":return[640,480];case"720p":return[1280,720];case"1080p":return[1920,1080];default:return[1280,720]}}},{key:"calculateStreamSize",value:function(){var e,n,t,i=$(window).width(),a=$(window).height(),s=this.getResolutionArray(this.videoProfile),l=void 0,r=void 0;return t=(e=i-100)/(n=a-80),s[0]/s[1]>t?(l=e,r=e*s[1]/s[0]):(r=n,l=n*s[0]/s[1]),{width:l=Math.max(l,160),height:r=Math.max(r,120)}}}]),e}(),v=t("3cXf"),f=t.n(v),g=function(){function e(n){a()(this,e),this.signal=Signal(n),this.call_holding=null,this.call_active=null,this.channel=null,this.appid=n,this.uid=null,this.onInviteReceived=null,this.onInviteEndByPeer=null}return d()(e,[{key:"login",value:function(e){var n=this,t=$.Deferred();this.appid;s.log("Logging in "+e);var i=this.signal.login(e,"_no_need_token");return i.onLoginSuccess=$.proxy(function(e){s.log("login success "+e),n.uid=e,t.resolve()},this),i.onLoginFailed=$.proxy(function(e){s.log("login failed "+e),n.session=null,t.reject()},this),i.onInviteReceived=$.proxy(this._onInviteReceived,this),this.session=i,t.promise()}},{key:"call",value:function(e,n,t){var i=this,a=$.Deferred(),l={};t&&(l._require_peer_online=1);var r=f()(l);s.log("call "+n+" , channelName : "+e+", extra : "+r);var o=this.session.channelInviteUser2(e,n,r);return o.onInviteAcceptedByPeer=$.proxy(function(e){i.call_active=i.call_holding,i.call_holding=null,i.join(o.channelName).then(function(n){s.log("call.onInviteAcceptedByPeer "+e),a.resolve()})},this),o.onInviteRefusedByPeer=$.proxy(function(e){s.log("call.onInviteRefusedByPeer "+e);var n=JSON.parse(e).status;a.reject({reason:"Call refused. "+i.statusText(n)})},this),o.onInviteFailed=$.proxy(function(e){s.log("call.onInviteFailed "+e),a.reject({reason:"Invite failed: "+JSON.parse(e).reason})},this),o.onInviteEndByPeer=$.proxy(this._onInviteEndByPeer,this),this.call_holding=o,a.promise()}},{key:"join",value:function(e,n){var t=$.Deferred();s.log("Joining channel "+e);var i=this.session.channelJoin(e);return i.onChannelJoined=function(e){s.log("channel.onChannelJoined"),t.resolve()},i.onChannelJoinFailed=function(e){s.log("channel.onChannelJoinFailed "+e),t.reject(e)},i.onMessageChannelReceive=$.proxy(this._onMessageChannelReceive,this),this.channel=i,t.promise()}},{key:"leave",value:function(){var e=this,n=$.Deferred(),t=this.channel;return null===t?n.resolve().promise():(t.onChannelLeaved=$.proxy(function(t){s.log("channel.onChannelLeaved"),e.channel=null,n.resolve()},this),t.channelLeave(),n)}},{key:"acceptCall",value:function(e){var n=$.Deferred();return this.call_active=this.call_holding,this.call_holding=null,this.join(e.channelName).done(function(t){e.channelInviteAccept(),n.resolve({peer:e.peer,channelName:e.channelName})}).catch(function(e){n.reject(e)}),n.promise()}},{key:"rejectCall",value:function(e,n){var t=$.Deferred();return n=n||0,e.channelInviteRefuse(f()({status:n})),t.resolve().promise()}},{key:"endCall",value:function(e,n){var t=this,i=$.Deferred();this.channel;return e.onInviteEndByMyself=$.proxy(function(n){s.log("call.onInviteEndByMyself "+n),t.call_holding=t.call_holding===e?null:t.call_holding,t.call_active=t.call_active===e?null:t.call_active,t.leave()},this),n?(this.call_active=null,this.call_holding=null):e.channelInviteEnd(),i.promise()}},{key:"statusText",value:function(e){switch(e){case 0:return"Peer rejected.";case 1:return"Peer is busy."}}},{key:"broadcastMessage",value:function(e){this.channel&&this.channel.messageChannelSend(e)}},{key:"_onInviteReceived",value:function(e){s.log("recv invite from "+e.peer+", "+e.channelName+", "+e.extra),null!==this.call_active?this.rejectCall(e,1):(e.onInviteEndByPeer=$.proxy(this._onInviteEndByPeer,this),this.call_holding=e,null!==this.onInviteReceived&&this.onInviteReceived(e))}},{key:"_onInviteEndByPeer",value:function(e){s.log("call.onInviteEndByPeer "+e),null!==this.onInviteEndByPeer&&this.onInviteEndByPeer()}},{key:"_onMessageChannelReceive",value:function(e,n,t){this.onMessageChannelReceive&&this.localAccount!==e&&this.onMessageChannelReceive(this.channel.name,t)}}]),e}(),m=function(){function e(n,t,i){a()(this,e),this.signal=n,this.rtc=t,this.localAccount=i,this.channelName="",this.sound_ring=new Howl({src:["https://rexyanglucky.github.io/video-call/assets/sound/basic_ring.mp3"],loop:!0}),this.sound_tones=new Howl({src:["https://rexyanglucky.github.io/video-call/assets/sound/basic_tones.mp3"],loop:!0}),this.signal.onInviteReceived=$.proxy(this.onInviteReceived,this),this.signal.onInviteEndByPeer=$.proxy(this.onInviteEndByPeer,this),this.signal.onMessageChannelReceive=$.proxy(this.onMessageChannelReceive,this),this.subscribeEvents()}return d()(e,[{key:"sendMessage",value:function(e){if(!e.trim())return!1;var n=$(".chart_warp"),t={ts:new Date,text:e,account:this.localAccount};n.append(this.buildMsg(e,!0,t.ts)),n.scrollTop(n[0].scrollHeight),this.signal.broadcastMessage(f()(t))}},{key:"buildMsg",value:function(e,n,t){var i="",a=t.toString();return a&&(i+="<div>"+a+"</div>"),i+='<li class="'+(n?"message right clearfix":"message clearfix")+'">',i+='<img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/245657/1_copy.jpg">',i+='<div class="bubble">'+o.safe_tags_replace(e)+'<div class="corner"></div>',i+="<span>"+this.parseTwitterDate(t)+"</span></div></li>"}},{key:"parseTwitterDate",value:function(e){var n=new Date(Date.parse(e)),t=new Date,i=Math.floor((t-n)/1e3);return i<=1?"just now":i<20?i+" seconds ago":i<40?"half a minute ago":i<60?"less than a minute ago":i<=90?"one minute ago":i<=3540?Math.round(i/60)+" minutes ago":i<=5400?"1 hour ago":i<=86400?Math.round(i/3600)+" hours ago":i<=129600?"1 day ago":i<604800?Math.round(i/86400)+" days ago":i<=777600?"1 week ago":"on "+n}},{key:"onMessageChannelReceive",value:function(e,n){this.onReceiveMessage(e,n,"channel")}},{key:"onReceiveMessage",value:function(e,n,t){var i=$(".chart_warp"),a=JSON.parse(n);i.append(this.buildMsg(a.text,!1,new Date)),i.scrollTop(i[0].scrollHeight)}},{key:"requestRemoteAccount",value:function(){var e=$.Deferred(),n=(this.localAccount,r.getParameterByName("remoteaccount"));return e.resolve(n),e}},{key:"call",value:function(e,n,t){var i=$.Deferred(),a=$(".callingModal");return a.find(".callee").html(n),this.signal.call(e,n,t).done(function(e){a.hide(),$(".op_warp").hide(),i.resolve()}).catch($.proxy(function(e){l.show(e.reason),i.reject()},this)),i.promise()}},{key:"endCall",value:function(e,n){var t=$.Deferred(),i=this.signal,a=this.rtc,s=$(".toolbar .muteBtn");return $(".op_warp").show(),a.muted=!0,s.removeClass("btn-info").addClass("btn-secondary"),s.find("i").html("mic"),a.end(),i.endCall(e,n),t.promise()}},{key:"ringCalling",value:function(e){e?this.sound_ring.play():this.sound_ring.stop()}},{key:"ringCalled",value:function(e){e?this.sound_tones.play():this.sound_tones.stop()}},{key:"subscribeEvents",value:function(){var e=this,n=this.signal,t=this,i=this.rtc;$(".toolbar .endCallBtn").off("click").on("click",$.proxy(function(t){e.ringCalling(!1),e.endCall(n.call_active||n.call_holding,!1)},this)),$(".toolbar .muteBtn").off("click").on("click",$.proxy(function(e){var n=$(e.currentTarget);i.toggleMute(),i.muted?(n.removeClass("btn-secondary").addClass("btn-info"),n.find("i").html("mic_off")):(n.removeClass("btn-info").addClass("btn-secondary"),n.find("i").html("mic"))},this)),$("#btn_send_call").off("click").on("click",$.proxy(function(a){e.requestRemoteAccount().done($.proxy(function(a){""!==a&&(e.ringCalling(!0),$.when(i.init(t.channelName,!1),e.call(t.channelName,a,!0)).done($.proxy(function(n,t){e.ringCalling(!1),e.rtc.rtc.publish(n)},e)).catch($.proxy(function(t){e.ringCalling(!1),e.endCall(n.call_active||n.call_holding,!1)},e)))},e))},this)),$("#message_to_send").off("keydown").on("keydown",function(e){13==e.keyCode&&(e.preventDefault(),t.sendMessage($(this).val()),$(this).val(""))}),$("#btn_send_msg").off("click").on("click",function(){t.sendMessage($("#message_to_send").val()),$("#message_to_send").val("")})}},{key:"onInviteReceived",value:function(e){var n=this,t=$(".calledModal"),i=this.signal,a=this.rtc;t.find(".caller").html(e.peer),t.find(".declineBtn").off("click").on("click",function(a){t.hide(),n.ringCalled(!1),i.rejectCall(e,0)}),t.find(".acceptBtn").off("click").on("click",function(l){t.hide(),$(".startCallBtn").hide(),n.ringCalled(!1),i.acceptCall(e).done(function(e){a.init(e.channelName,!0)}).catch(function(e){s.log("Accept call failed: "+e)})}),this.ringCalled(!0),t.show()}},{key:"onInviteEndByPeer",value:function(){var e=this.signal;$(".calledModal").hide(),this.ringCalled(!1),this.endCall(e.call_active||e.call_holding,!0)}}]),e}(),p={created:function(){},mounted:function(){var e,n,t,i,a;e=jQuery,n="e35545b1552e426d93a535a6e96385ff",t=r.getParameterByName("account"),r.getParameterByName("remoteaccount"),i=new g(n,"57fdba25dc7b406391424cc3cd5dc5de"),a=new h(n),new m(i,a,t).channelName="room_test_interview",i.login(t).done(function(n){e("#btn_send_call").css("background","cadetblue"),i.join("room_test_interview")})}},y={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("div",{staticClass:"main_warp"},[t("h2",[e._v("中国联合通讯集团2018产品经理岗在线面试")]),e._v(" "),t("div",{staticClass:"preview_warp"}),e._v(" "),t("div",{staticClass:"call_warp"},[t("div",{staticClass:"media_warp"},[t("div",{staticClass:"op_warp"},[t("span",{staticClass:"btn_send media_call",attrs:{id:"btn_send_call"}},[e._v("发起视频")]),e._v(" "),t("span",{staticClass:"revice_warp calledModal"},[t("p",{staticClass:"caller"}),e._v(" "),t("p",{staticClass:"status"},[e._v("Calling...")]),e._v(" "),t("span",{staticClass:"btn_send media_call acceptBtn"},[e._v("接受")]),e._v(" "),t("span",{staticClass:"btn_send media_call declineBtn"},[e._v("拒绝")])])]),e._v(" "),t("div",{staticClass:"toolbar"})]),e._v(" "),t("div",{staticClass:"msg_warp"},[t("ul",{staticClass:"chart_warp"}),e._v(" "),t("div",{staticClass:"send_warp"},[t("input",{attrs:{type:"text",id:"message_to_send"}}),e._v(" "),t("span",{staticClass:"btn_send",attrs:{id:"btn_send_msg"}},[e._v("发送")])])])])])])}]};var _=t("Z0/y")(p,y,!1,function(e){t("8OPQ")},"data-v-7e314f5f",null);n.default=_.exports},"8OPQ":function(e,n){},AA3o:function(e,n,t){"use strict";n.__esModule=!0,n.default=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}},adMp:function(e,n,t){t("pBXl");var i=t("UusJ").Object;e.exports=function(e,n,t){return i.defineProperty(e,n,t)}},liLe:function(e,n,t){e.exports={default:t("adMp"),__esModule:!0}},pBXl:function(e,n,t){var i=t("MITN");i(i.S+i.F*!t("M7ni"),"Object",{defineProperty:t("qRYU").f})},xSur:function(e,n,t){"use strict";n.__esModule=!0;var i,a=t("liLe"),s=(i=a)&&i.__esModule?i:{default:i};n.default=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,s.default)(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}()}});
//# sourceMappingURL=2.00c53a5b619abe02050d.js.map